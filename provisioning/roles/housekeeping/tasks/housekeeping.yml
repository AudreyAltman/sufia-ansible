---
- name: update apt cache
  apt: update_cache=yes

- name: upgrade apt packages
  apt: upgrade=full

- name: create install group
  sudo: yes
  group: name={{ install_group }} state=present

- name: create install user
  sudo: yes
  user: name={{ install_user }} group={{ install_group }} shell=/bin/bash createhome=yes state=present

- name: chown /opt
  file: owner={{ install_user }} group={{ install_group }} state=directory path=/opt

- name: create install directory
  file: owner={{ install_user }} group={{ install_group }} state=directory path=/opt/install

- name: create cap group
  sudo: yes
  group: name={{ capistrano_group }} state=present

- name: create cap user
  sudo: yes
  user: name={{ capistrano_user }} group={{ capistrano_group }} shell=/bin/bash createhome=yes state=present

- name: create cap shared directories
  sudo: yes
  file: path={{ item }} state=directory owner={{ capistrano_user }} group={{ capistrano_group }} 
  with_items:
    - /opt/sufia/shared/config
    - /opt/sufia/releases

- name: add keys for capistrano user
  sudo: yes
  copy: src=team_keys dest=/home/{{ capistrano_user }}/.ssh/authorized_keys owner={{ capistrano_user }} group={{ capistrano_group }} mode=0644
